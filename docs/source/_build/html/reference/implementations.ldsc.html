
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>LDSC &#8212; funkea 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="SNPsea" href="implementations.snpsea.html" />
    <link rel="prev" title="GARFIELD" href="implementations.garfield.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-funkea.implementations.ldsc">
<span id="ldsc"></span><h1>LDSC<a class="headerlink" href="#module-funkea.implementations.ldsc" title="Permalink to this heading">¶</a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.LDSC">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">LDSC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pipeline</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Pipeline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Method</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.implementations.ldsc.LDSC" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes functional enrichment using <code class="docutils literal notranslate"><span class="pre">LDSC</span></code>.</p>
<p>Stratified LD score regression has been used for functional and tissue enrichment analysis <a class="footnote-reference brackets" href="#id4" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>
<a class="footnote-reference brackets" href="#id5" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. It is defined as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbb{E} \left[ \boldsymbol{\chi}^2 | \mathbf{C}, \mathbf{K} \right] &amp;= \mathbf{R} \mathbf{z} + b \\
\mathbf{z} &amp;= \mathbf{C}^T \boldsymbol{\alpha} + \mathbf{K}^T \boldsymbol{\beta}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{R}\)</span> is the square LD correlation matrix. Similarly to
<a class="reference internal" href="implementations.garfield.html#funkea.implementations.garfield.GARFIELD" title="funkea.implementations.garfield.GARFIELD"><code class="xref py py-class docutils literal notranslate"><span class="pre">GARFIELD</span></code></a>, the enrichment of partition <span class="math notranslate nohighlight">\(i\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[e_i = \frac{1}{P} \beta_i\]</div>
<p>where <span class="math notranslate nohighlight">\(P\)</span> is the sample size (i.e. number of patients) used in the GWAS. From LD score
regression, we can see that this is the total heritability of partition <span class="math notranslate nohighlight">\(i\)</span> <a class="footnote-reference brackets" href="#id4" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. From
this enrichment we get the <span class="math notranslate nohighlight">\(p\)</span>-value in the usual way:</p>
<div class="math notranslate nohighlight">
\[p_i = 1 - F\left(  \frac{e_i P}{SE(e_i P)} \right)\]</div>
<p>The adjacency matrix <span class="math notranslate nohighlight">\(\mathbf{L}\)</span> is again constructed in a slightly different way. Here,
every variant is considered individually, and considered “linked” to a particular annotation if
it is within 100kb of that annotation. Moreover, <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> is usually another
<span class="math notranslate nohighlight">\(\mathbf{K}\)</span>, derived from a different <span class="math notranslate nohighlight">\(\mathbf{X}\)</span> and <span class="math notranslate nohighlight">\(\mathbf{L}\)</span> — i.e.
different annotations and corresponding partitions.</p>
<p class="rubric">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id4" role="note">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id3">2</a>)</span>
<p>Finucane, H.K., Bulik-Sullivan, B., Gusev, A., Trynka, G., Reshef, Y., Loh, P.R.,
Anttila, V., Xu, H., Zang, C., Farh, K. and Ripke, S., 2015. Partitioning heritability
by functional annotation using genome-wide association summary statistics.
Nature genetics, 47(11), pp.1228-1235.</p>
</aside>
<aside class="footnote brackets" id="id5" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Finucane, H.K., Reshef, Y.A., Anttila, V., Slowikowski, K., Gusev, A., Byrnes, A.,
Gazal, S., Loh, P.R., Lareau, C., Shoresh, N. and Genovese, G., 2018. Heritability
enrichment of specifically expressed genes identifies disease-relevant tissues and cell
types. Nature genetics, 50(4), pp.621-629.</p>
</aside>
</aside>
<dl class="py method">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.LDSC.compute_partitioned_ld_scores">
<span class="sig-name descname"><span class="pre">compute_partitioned_ld_scores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pyspark.sql.dataframe.DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">pyspark.sql.dataframe.DataFrame</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#funkea.implementations.ldsc.LDSC.compute_partitioned_ld_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the partitioned LD scores for the provided annotation data.</p>
<p>It is generally recommended to precompute the partitioned LD scores before running any
analysis, as this is a very compute intensive operation. For this purpose, invoke this
method and then write the resulting dataframe to disk. The stored LD scores can then be
loaded by using the <code class="docutils literal notranslate"><span class="pre">with_precomputed_ld_scores</span></code> method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>batch_size</strong> – An optional batch size argument, specifying how many unique partitions will
be processed at once. This is useful if the dataset has many partitions and is
difficult to process all at once. If None, all partitions will be processed at once.
(<code class="docutils literal notranslate"><span class="pre">default=None</span></code>)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataframe containing the precomputed LD scores or a list of dataframes, one dataframe
per batch (+ 1 for the control LD scores).</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>The following example would compute the partitioned LD scores for the GTEx dataset:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LDSC</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ld_scores</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">compute_partitioned_ld_scores</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ld_scores</span><span class="o">.</span><span class="n">columns</span>
<span class="go">[&#39;partition_id&#39;, &#39;rsid&#39;, &#39;ancestry&#39;, &#39;ld_score&#39;, &#39;n_variants&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ld_scores</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&quot;some/file/path&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Another example, where we set the batch size (useful for <em>very</em> large datasets):</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span><span class="p">:</span> <span class="n">SparkSession</span>
<span class="go">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">ld_scores</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">compute_partitioned_ld_scores</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="p">(</span>
<span class="gp">... </span>        <span class="n">ld_scores</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">mode</span><span class="p">(</span><span class="s2">&quot;overwrite&quot;</span> <span class="k">if</span> <span class="n">ix</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;append&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="s2">&quot;some/file/path&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># clear the cache to avoid memory build-up (caching done internally in LD</span>
<span class="gp">... </span><span class="c1"># computation)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span><span class="o">.</span><span class="n">catalog</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<p>If <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> is specified, make sure to clear the cache after saving the dataframes
in the returned list. This is because we use caching internally to speed up some
(otherwise repeated) computation. The easiest way to do this is by using
<code class="docutils literal notranslate"><span class="pre">SparkSession.catalog.clearCache</span></code> (see Examples).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.LDSC.default">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">default</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">annotation:</span> <span class="pre">~typing.Optional[~funkea.core.data.AnnotationComponent]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params:</span> <span class="pre">~funkea.implementations.ldsc.Params</span> <span class="pre">=</span> <span class="pre">Params(expansion_window=100000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maf_threshold=0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precomputed_ld_scores=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">controlling_ld_scores=&lt;funkea.implementations.ldsc.LDScores</span> <span class="pre">object&gt;)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Self</span></span></span><a class="headerlink" href="#funkea.implementations.ldsc.LDSC.default" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the default configuration of <code class="docutils literal notranslate"><span class="pre">LDSC</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>annotation</strong> – The annotation to use. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, the PEM annotation from GTEx will be
used. (<code class="docutils literal notranslate"><span class="pre">default=None</span></code>)</p></li>
<li><p><strong>params</strong> – The parameters to use. (<code class="docutils literal notranslate"><span class="pre">default=LDSC.Params()</span></code>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.LDSC.with_controlling_ld_scores">
<span class="sig-name descname"><span class="pre">with_controlling_ld_scores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pyspark.sql.dataframe.DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funkea.implementations.ldsc.LDScoreColumns" title="funkea.implementations.ldsc.LDScoreColumns"><span class="pre">LDScoreColumns</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LDScoreColumns(id='rsid',</span> <span class="pre">partition_id='partition_id',</span> <span class="pre">ld_score='ld_score',</span> <span class="pre">n_variants='n_variants',</span> <span class="pre">ancestry='ancestry')</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#funkea.implementations.ldsc.LDSC" title="funkea.implementations.ldsc.LDSC"><span class="pre">LDSC</span></a></span></span><a class="headerlink" href="#funkea.implementations.ldsc.LDSC.with_controlling_ld_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the controlling LD scores.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – Path to the controlling LD scores, or the dataframe itself.</p></li>
<li><p><strong>columns</strong> – The column names. (<code class="docutils literal notranslate"><span class="pre">default=LDScoreColumns()</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The <code class="docutils literal notranslate"><span class="pre">LDSC</span></code> instance with the controlling LD scores set.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LDSC</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">with_controlling_ld_scores</span><span class="p">(</span><span class="s2">&quot;some/file/path&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.LDSC.with_precomputed_ld_scores">
<span class="sig-name descname"><span class="pre">with_precomputed_ld_scores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pyspark.sql.dataframe.DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funkea.implementations.ldsc.LDScoreColumns" title="funkea.implementations.ldsc.LDScoreColumns"><span class="pre">LDScoreColumns</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LDScoreColumns(id='rsid',</span> <span class="pre">partition_id='partition_id',</span> <span class="pre">ld_score='ld_score',</span> <span class="pre">n_variants='n_variants',</span> <span class="pre">ancestry='ancestry')</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#funkea.implementations.ldsc.LDSC" title="funkea.implementations.ldsc.LDSC"><span class="pre">LDSC</span></a></span></span><a class="headerlink" href="#funkea.implementations.ldsc.LDSC.with_precomputed_ld_scores" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the precomputed LD scores.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – Path to the precomputed LD scores, or the dataframe itself.</p></li>
<li><p><strong>columns</strong> – The column names. (<code class="docutils literal notranslate"><span class="pre">default=LDScoreColumns()</span></code>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The <code class="docutils literal notranslate"><span class="pre">LDSC</span></code> instance with the precomputed LD scores set.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LDSC</span><span class="o">.</span><span class="n">default</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">with_precomputed_ld_scores</span><span class="p">(</span><span class="s2">&quot;some/file/path&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.LDScoreColumns">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">LDScoreColumns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'rsid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'partition_id'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ld_score</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'ld_score'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_variants</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'n_variants'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ancestry</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'ancestry'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.implementations.ldsc.LDScoreColumns" title="Permalink to this definition">¶</a></dt>
<dd><p>Column name mapping for the LD scores.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.LDScores">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">LDScores</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funkea.implementations.ldsc.LDScoreColumns" title="funkea.implementations.ldsc.LDScoreColumns"><span class="pre">LDScoreColumns</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">LDScoreColumns(id='rsid',</span> <span class="pre">partition_id='partition_id',</span> <span class="pre">ld_score='ld_score',</span> <span class="pre">n_variants='n_variants',</span> <span class="pre">ancestry='ancestry')</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.implementations.ldsc.LDScores" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads LD scores from disk or memory.</p>
<p>This is a data component which can be used to load LD scores. These will be precomputed LD
scores, either used for enrichment or as controlling covariates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataset</strong> – Path to the LD scores, or the dataframe itself. If None, an error will be
raised when trying to load the data. (<code class="docutils literal notranslate"><span class="pre">default=None</span></code>)</p></li>
<li><p><strong>columns</strong> – The column name mapping for the dataframe. (<code class="docutils literal notranslate"><span class="pre">default=LDScoreColumns()</span></code>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.Method">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">Method</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">partition_id_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">control_ld</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('control',)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.implementations.ldsc.Method" title="Permalink to this definition">¶</a></dt>
<dd><p>Estimate enrichment using LD score regression.</p>
<p>This method is based on the LD score regression method described in Bulik-Sullivan et al. (2015).
The method is implemented in the <code class="docutils literal notranslate"><span class="pre">ldsc</span></code> Python package (shipped together with <code class="docutils literal notranslate"><span class="pre">funkea</span></code>). The
method is described in detail in <a class="reference internal" href="#funkea.implementations.ldsc.LDSC" title="funkea.implementations.ldsc.LDSC"><code class="xref py py-class docutils literal notranslate"><span class="pre">LDSC</span></code></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ldsc</span></code> provides GPU support for the LD score regression. To enable GPU support, set the
<code class="docutils literal notranslate"><span class="pre">LDSC_BACKEND</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">JAX</span></code>. Note that GPU support is experimental and
might not work for all datasets. If GPU support is enabled, the method will automatically
use the GPU if available (you will need to provide GPUs to the Spark executors). This can be
very helpful for annotation datasets with many partitions (each partition has to fit its own
LD score regression model).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>partition_id_col</strong> – The name of the column containing the partition ID.</p></li>
<li><p><strong>control_ld</strong> – The names of the columns containing the LD scores of the controlling
covariates. The LD scores of the controlling covariates will be used to control for
the effects of the covariates in the LD score regression model.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.Params">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">Params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expansion_window:</span> <span class="pre">~pydantic.types.NonNegativeInt</span> <span class="pre">=</span> <span class="pre">100000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maf_threshold:</span> <span class="pre">~funkea.core.utils.types.HalfUnitFloat</span> <span class="pre">=</span> <span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precomputed_ld_scores:</span> <span class="pre">funkea.implementations.ldsc.LDScores</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">controlling_ld_scores:</span> <span class="pre">funkea.implementations.ldsc.LDScores</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">&lt;funkea.implementations.ldsc.LDScores</span> <span class="pre">object&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.implementations.ldsc.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Parameters for the default configuration of <code class="docutils literal notranslate"><span class="pre">LDSC</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>expansion_window</strong> – The size of the window within which a variant and an annotation can be
overlapped. (<code class="docutils literal notranslate"><span class="pre">default=100_000</span></code>)</p></li>
<li><p><strong>maf_threshold</strong> – The minimum MAF of the variants to be used in the regression.
(<code class="docutils literal notranslate"><span class="pre">default=0.01</span></code>)</p></li>
<li><p><strong>precomputed_ld_scores</strong> – Optional precomputed LD scores. (<code class="docutils literal notranslate"><span class="pre">default=None</span></code>)</p></li>
<li><p><strong>controlling_ld_scores</strong> – Optional controlling LD scores. (<code class="docutils literal notranslate"><span class="pre">default=None</span></code>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.Pipeline">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">Pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">locus_definition:</span> <span class="pre">~funkea.components.locus_definition.LocusDefinition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variant_selector:</span> <span class="pre">~typing.Optional[~funkea.components.variant_selection.VariantSelection]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighting_ld_scores:</span> <span class="pre">~funkea.implementations.ldsc.LDScores</span> <span class="pre">=</span> <span class="pre">&lt;funkea.implementations.ldsc.LDScores</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">precomputed_ld_scores:</span> <span class="pre">~typing.Optional[~funkea.implementations.ldsc.LDScores]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">controlling_ld_scores:</span> <span class="pre">funkea.implementations.ldsc.LDScores</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">&lt;funkea.implementations.ldsc.LDScores</span> <span class="pre">object&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ld_component:</span> <span class="pre">~typing.Optional[~funkea.core.data.LDComponent]</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_partitions_ld_computation:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">10000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.implementations.ldsc.Pipeline" title="Permalink to this definition">¶</a></dt>
<dd><p>Data pipeline for LD score regression.</p>
<p>This pipeline prepares the data for LD score regression. It requires a locus definition and
variant selection method to be provided. If not available, it will compute the partitioned
LD scores for the annotation dataset provided.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>locus_definition</strong> – The locus definition to use for the analysis.</p></li>
<li><p><strong>variant_selector</strong> – The variant selection method to use for the analysis.</p></li>
<li><p><strong>weighting_ld_scores</strong> – The LD scores to used for computing the regression weights. These
should be precomputed. Make sure to use the correct ancestry.</p></li>
<li><p><strong>precomputed_ld_scores</strong> – The precomputed LD scores to use for the analysis. If not provided,
the pipeline will compute the LD scores from the annotation dataset.</p></li>
<li><p><strong>controlling_ld_scores</strong> – The LD scores to use as controlling covariates. These should be
precomputed. Make sure to use the correct ancestry.</p></li>
<li><p><strong>ld_component</strong> – The LD component to use for the analysis. If no precomputed LD scores are]
provided, this will be used to compute the LD scores.</p></li>
<li><p><strong>n_partitions_ld_computation</strong> – The number of partitions to use for computing the LD scores.
<code class="docutils literal notranslate"><span class="pre">partitions</span></code> here refers to Spark partitions. It can be important to control this
number to avoid memory issues. For example, if the number of partitions or annotations
is very high, it can be that each Spark partition will be too large to fit in memory.
Hence, if you get memory errors, try to increase this number. However, decrease this
if garbage collection is taking too long. (<code class="docutils literal notranslate"><span class="pre">default=10_000</span></code>)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.compute_chi2">
<span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">compute_chi2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sumstats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#funkea.implementations.ldsc.compute_chi2" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the <span class="math notranslate nohighlight">\(\chi^2\)</span> association statistics from summary statistics.</p>
<p>The statistic is either computed from <span class="math notranslate nohighlight">\(\beta\)</span> and <span class="math notranslate nohighlight">\(SE(\beta)\)</span> or from
<span class="math notranslate nohighlight">\(p\)</span>-values depending on which columns are available.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>sumstats</strong> – The GWAS summary statistics containing either coefficients and standard error, or
the <span class="math notranslate nohighlight">\(p\)</span>-values.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The original dataframe with an additional <span class="math notranslate nohighlight">\(\chi^2\)</span> column.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="funkea.implementations.ldsc.fit_ldsc_model">
<span class="sig-prename descclassname"><span class="pre">funkea.implementations.ldsc.</span></span><span class="sig-name descname"><span class="pre">fit_ldsc_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sumstats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">_LDSCColumns</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#funkea.implementations.ldsc.fit_ldsc_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a heritability model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sumstats</strong> – A pandas DataFrame containing the summary statistics and LD scores.</p></li>
<li><p><strong>columns</strong> – A pydantic model containing the column names of the sumstats DataFrame.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A pandas DataFrame containing the enrichment estimate of the target.</p>
</dd>
</dl>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">funkea</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="components.html">funkea.components</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">funkea.core</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="implementations.html">funkea.implementations</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">funkea API</a><ul>
  <li><a href="implementations.html">Implementations</a><ul>
      <li>Previous: <a href="implementations.garfield.html" title="previous chapter">GARFIELD</a></li>
      <li>Next: <a href="implementations.snpsea.html" title="next chapter">SNPsea</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023-2023, Benjamin Tenmann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/reference/implementations.ldsc.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>