
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Normalisation &#8212; funkea 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Variant Selection" href="components.variant_selection.html" />
    <link rel="prev" title="Locus Definition" href="components.locus_definition.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-funkea.components.normalisation">
<span id="normalisation"></span><h1>Normalisation<a class="headerlink" href="#module-funkea.components.normalisation" title="Permalink to this heading">¶</a></h1>
<p>Set of normalisation transforms.</p>
<dl class="py class">
<dt class="sig sig-object py" id="funkea.components.normalisation.Compose">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.components.normalisation.</span></span><span class="sig-name descname"><span class="pre">Compose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">steps</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#funkea.components.normalisation.Normalisation" title="funkea.components.normalisation.Normalisation"><span class="pre">Normalisation</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.components.normalisation.Compose" title="Permalink to this definition">¶</a></dt>
<dd><p>Composes a sequence of normalisation steps.</p>
<p>This is a convenience class that allows for composing multiple normalisation steps into a single
transformer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>*steps</strong> – A sequence of normalisation steps.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">funkea.components.normalisation</span> <span class="kn">import</span> <span class="n">Compose</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">QuantileNorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+-------+-----+</span>
<span class="go">| id|feature|value|</span>
<span class="go">+---+-------+-----+</span>
<span class="go">|  1|      1|  1.0|</span>
<span class="go">|  1|      2|  2.0|</span>
<span class="go">|  1|      3|  3.0|</span>
<span class="go">|  2|      1|  4.0|</span>
<span class="go">|  2|      2|  5.0|</span>
<span class="go">|  2|      3|  6.0|</span>
<span class="go">+---+-------+-----+</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normaliser</span> <span class="o">=</span> <span class="n">Compose</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">StandardScaler</span><span class="p">(</span><span class="n">values_col</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">output_col</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">partition_by</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,)),</span>
<span class="gp">... </span>    <span class="n">QuantileNorm</span><span class="p">(</span><span class="n">values_col</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">output_col</span><span class="o">=</span><span class="s2">&quot;quantile_norm&quot;</span><span class="p">,</span> <span class="n">partition_by</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,)),</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">normaliser</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+-------+-----+------+-------------+</span>
<span class="go">| id|feature|value|scaled|quantile_norm|</span>
<span class="go">+---+-------+-----+------+-------------+</span>
<span class="go">|  1|      1|  1.0|  -1.0|         -1.0|</span>
<span class="go">|  1|      2|  2.0|   0.0|          0.0|</span>
<span class="go">|  1|      3|  3.0|   1.0|          1.0|</span>
<span class="go">|  2|      1|  4.0|  -1.0|         -1.0|</span>
<span class="go">|  2|      2|  5.0|   0.0|          0.0|</span>
<span class="go">|  2|      3|  6.0|   1.0|          1.0|</span>
<span class="go">+---+-------+-----+------+-------------+</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.components.normalisation.EuclidNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.components.normalisation.</span></span><span class="sig-name descname"><span class="pre">EuclidNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('id',)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.components.normalisation.EuclidNorm" title="Permalink to this definition">¶</a></dt>
<dd><p>Normalises partitions into unit-length.</p>
<p>For a given partition represented as vector <span class="math notranslate nohighlight">\(\mathbf{x}\)</span>, the euclid normalisation is
defined in the standard way:</p>
<div class="math notranslate nohighlight">
\[\bar{\mathbf{x}} = \frac{1}{||\mathbf{x}||_2} \mathbf{x}\]</div>
<p class="rubric">Notes</p>
<p>If a certain partition produces <span class="math notranslate nohighlight">\(||\mathbf{x}||_2 = 0\)</span>, <span class="math notranslate nohighlight">\(\hat{\mathbf{x}}\)</span> will
be set to <span class="math notranslate nohighlight">\(0\)</span> for each element.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.components.normalisation.Identity">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.components.normalisation.</span></span><span class="sig-name descname"><span class="pre">Identity</span></span><a class="headerlink" href="#funkea.components.normalisation.Identity" title="Permalink to this definition">¶</a></dt>
<dd><p>The identity transform.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.components.normalisation.Normalisation">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.components.normalisation.</span></span><span class="sig-name descname"><span class="pre">Normalisation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('id',)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.components.normalisation.Normalisation" title="Permalink to this definition">¶</a></dt>
<dd><p>Base class for normalisation transforms.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.components.normalisation.QuantileNorm">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.components.normalisation.</span></span><span class="sig-name descname"><span class="pre">QuantileNorm</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('id',)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.components.normalisation.QuantileNorm" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs quantile normalisation.</p>
<p>Quantile normalisation <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> is a method for matching the quantiles of multiple distributions.
Briefly, it first assigns the values in each partition to their quantiles, takes mean of the
quantiles over the partitions, and then replaces the original values with the averaged
quantiles.</p>
<p class="rubric">References</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Quantile_normalization">https://en.wikipedia.org/wiki/Quantile_normalization</a></p>
</aside>
</aside>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">funkea.components.normalisation</span> <span class="kn">import</span> <span class="n">QuantileNorm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
<span class="gp">... </span>    <span class="p">[</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
<span class="gp">... </span>        <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">),</span>
<span class="gp">... </span>    <span class="p">],</span>
<span class="gp">... </span>    <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">],</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+-------+-----+</span>
<span class="go">| id|feature|value|</span>
<span class="go">+---+-------+-----+</span>
<span class="go">|  1|      1|  1.0|</span>
<span class="go">|  1|      2|  2.0|</span>
<span class="go">|  1|      3|  3.0|</span>
<span class="go">|  2|      1|  4.0|</span>
<span class="go">|  2|      2|  5.0|</span>
<span class="go">|  2|      3|  6.0|</span>
<span class="go">+---+-------+-----+</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">QuantileNorm</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;norm_value&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="go">+---+-------+-----+----------+</span>
<span class="go">| id|feature|value|norm_value|</span>
<span class="go">+---+-------+-----+----------+</span>
<span class="go">|  1|      1|  1.0|       2.5|</span>
<span class="go">|  1|      2|  2.0|       3.5|</span>
<span class="go">|  1|      3|  3.0|       4.5|</span>
<span class="go">|  2|      1|  4.0|       2.5|</span>
<span class="go">|  2|      2|  5.0|       3.5|</span>
<span class="go">|  2|      3|  6.0|       4.5|</span>
<span class="go">+---+-------+-----+----------+</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="funkea.components.normalisation.StandardScaler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">funkea.components.normalisation.</span></span><span class="sig-name descname"><span class="pre">StandardScaler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">values_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition_by</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="p"><span class="pre">...</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('id',)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#funkea.components.normalisation.StandardScaler" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes <span class="math notranslate nohighlight">\(z\)</span>-scores.</p>
<p>Unlike the official implementation in <code class="docutils literal notranslate"><span class="pre">pyspark.ml</span></code>, this version allows for partitioning the
dataframe arbitrarily for computing the mean and standard deviation. It is defined in the
standard way:</p>
<div class="math notranslate nohighlight">
\[z = \frac{x - \mu}{\sigma}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span> are the sample mean and standard deviation, respectively.</p>
<p class="rubric">Notes</p>
<p><span class="math notranslate nohighlight">\(\sigma\)</span> is the <em>unbiased</em> estimator of the population standard deviation.</p>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">funkea</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">API Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="components.html">funkea.components</a></li>
<li class="toctree-l2"><a class="reference internal" href="core.html">funkea.core</a></li>
<li class="toctree-l2"><a class="reference internal" href="implementations.html">funkea.implementations</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">funkea API</a><ul>
  <li><a href="components.html">Components</a><ul>
      <li>Previous: <a href="components.locus_definition.html" title="previous chapter">Locus Definition</a></li>
      <li>Next: <a href="components.variant_selection.html" title="next chapter">Variant Selection</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023-2023, Benjamin Tenmann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/reference/components.normalisation.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>