
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Getting Started &#8212; funkea 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="funkea API" href="../reference/index.html" />
    <link rel="prev" title="Tutorials" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h1>
<p>In this tutorial, we will cover some of the basics of <code class="docutils literal notranslate"><span class="pre">funkea</span></code>, and run through a few simple examples of how one can get various enrichment results from GWAS sumstats. In these examples, we will use the <code class="docutils literal notranslate"><span class="pre">Fisher</span></code> method for computing the enrichments, as it is simple and quick.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">funkea.core</span> <span class="kn">import</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">funkea.implementations</span> <span class="kn">import</span> <span class="n">Fisher</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
</pre></div>
</div>
</div>
</div>
<p>Provide the filepath to your GWAS sumstats. Here we used <code class="docutils literal notranslate"><span class="pre">ieu-b7</span></code> from OpenGWAS, which is a Parkinson’s study on a European population.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SUMSTATS_PATH</span> <span class="o">=</span> <span class="s2">&quot;data/sumstats.parquet&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spark</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span>
    <span class="o">.</span><span class="n">master</span><span class="p">(</span><span class="s2">&quot;local[2]&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">sumstats</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">SUMSTATS_PATH</span><span class="p">)</span>
<span class="n">sumstats</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we instantiate the <code class="docutils literal notranslate"><span class="pre">AnnotationComponent</span></code> object. This is an abstraction layer on top of the genomic annotations data (which is provided in tabular format), such that annotations can be used interchangeably. Here, we used (a subset of) the KEGG dataset, where the annotations are the genes and the partitions are the KEGG pathways. The partition type is <code class="docutils literal notranslate"><span class="pre">HARD</span></code>, i.e. a gene is either in a pathway or not; there is no distribution. The <code class="docutils literal notranslate"><span class="pre">dataset</span></code> is provided as a filepath, but we could just as well passed in a Spark dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kegg</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">AnnotationComponent</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">AnnotationColumns</span><span class="p">(</span>
        <span class="n">annotation_id</span><span class="o">=</span><span class="s2">&quot;gene_id&quot;</span><span class="p">,</span> <span class="n">partition_id</span><span class="o">=</span><span class="s2">&quot;pathway_name&quot;</span>
    <span class="p">),</span>
    <span class="n">partition_type</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">PartitionType</span><span class="o">.</span><span class="n">HARD</span><span class="p">,</span>
    <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;data/kegg.parquet&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we instantiate the model, using the <code class="docutils literal notranslate"><span class="pre">default</span></code> configuration (more on this in the next section). We make sure to pass the annotation component to the default configuration, to overwrite the default annotation component (GTEx).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Fisher</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">annotation</span><span class="o">=</span><span class="n">kegg</span><span class="p">)</span>
<span class="n">enrichments</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sumstats</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">enrichments</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="composability">
<h2>Composability<a class="headerlink" href="#composability" title="Permalink to this heading">¶</a></h2>
<p>We saw how we could easily run functional enrichment experiments on GWAS sumstats using default configurations. However, <code class="docutils literal notranslate"><span class="pre">funkea</span></code> also offers ways of exploring various parameter settings and pipeline compositions to create new enrichment workflows.</p>
<p>But before we do so, let us consider some concepts <code class="docutils literal notranslate"><span class="pre">funkea</span></code> employs to make this possible. Every workflow implementation follows the schematic show below:</p>
<p><img alt="schematic" src="../_images/schematic.png" /></p>
<p>i.e. each workflow consists of (1) a data pipeline; and (2) an enrichment method. The former filters down the sumstats (<code class="docutils literal notranslate"><span class="pre">variant_selection</span></code>), creates loci from the remaining variants (<code class="docutils literal notranslate"><span class="pre">locus_definition</span></code>) and then finally associates these loci with annotations (<code class="docutils literal notranslate"><span class="pre">annotation</span></code>). The latter then takes the loci (including their annotations) and computes the study-wide enrichments for each annotation partition, and its respective significance.</p>
<p>In the following example, we will run the same enrichment experiment as above, but with some small modifications (purely for demonstration purposes):</p>
<ol class="arabic simple">
<li><p>We reduce the $p$-value threshold and remove the dropping of ambiguous variants from the <code class="docutils literal notranslate"><span class="pre">variant_selector</span></code>.</p></li>
<li><p>We replace a simple locus-annotation overlap with an overlap of an extended locus, i.e. we expand by $10,000$ base pairs into either direction.</p></li>
</ol>
<div class="alert alert-block alert-warning">
<b>Note:</b> While "variant_selection" transforms are both idempotent and commutative, "locus_definition" transforms are not. That means, the order in which they appear matters and some will assume that others have come before (e.g. "Merge" depends on "Collect").
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">funkea.components</span> <span class="kn">import</span> <span class="n">locus_definition</span> <span class="k">as</span> <span class="n">ld</span>
<span class="kn">from</span> <span class="nn">funkea.components</span> <span class="kn">import</span> <span class="n">variant_selection</span> <span class="k">as</span> <span class="n">vs</span>
<span class="kn">from</span> <span class="nn">funkea.implementations</span> <span class="kn">import</span> <span class="n">fisher</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Fisher</span><span class="p">(</span>
    <span class="n">pipeline</span><span class="o">=</span><span class="n">fisher</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">(</span>
        <span class="n">ld</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
            <span class="n">ld</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">extension</span><span class="o">=</span><span class="p">(</span><span class="mi">10_000</span><span class="p">,</span> <span class="mi">10_000</span><span class="p">)),</span>
            <span class="n">ld</span><span class="o">.</span><span class="n">Overlap</span><span class="p">(),</span>
            <span class="n">annotation</span><span class="o">=</span><span class="n">kegg</span>
        <span class="p">),</span>
        <span class="n">variant_selector</span><span class="o">=</span><span class="n">vs</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
            <span class="n">vs</span><span class="o">.</span><span class="n">AssociationThreshold</span><span class="p">(</span>
                <span class="n">threshold</span><span class="o">=</span><span class="mf">5e-10</span>
            <span class="p">),</span>
            <span class="n">vs</span><span class="o">.</span><span class="n">DropHLA</span><span class="p">(),</span>
            <span class="n">vs</span><span class="o">.</span><span class="n">DropIndel</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">),</span>
    <span class="n">method</span><span class="o">=</span><span class="n">fisher</span><span class="o">.</span><span class="n">Method</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">sumstats</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">truncate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">funkea</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Getting Started</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Tutorials</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Tutorials</a></li>
      <li>Next: <a href="../reference/index.html" title="next chapter">funkea API</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023-2023, Benjamin Tenmann.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/tutorials/getting_started.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>